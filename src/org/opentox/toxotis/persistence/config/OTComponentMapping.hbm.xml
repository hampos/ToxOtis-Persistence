<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <!-- OTComponent container class -->
    <class
        name="org.opentox.toxotis.core.OTComponent"
        dynamic-insert="true"
        dynamic-update="true"
        select-before-update="false"
        discriminator-value="OTComp"
        polymorphism="implicit"
        optimistic-lock="version"
        mutable="true">

        <id name="uri" type="org.opentox.toxotis.persistence.usertypes.VRIUserType"/>
        <!--    Foreign (M2O) key pointing to MetaInformation
                Question: is unique="true" correct here???
        -->
        <many-to-one cascade="all,delete-orphan" class="org.opentox.toxotis.ontology.MetaInfo" name="meta" unique="true"/>

        <!--
            BibTeX extends OTComponent
        -->
        <joined-subclass
            name="org.opentox.toxotis.core.component.BibTeX">
            <key column="uri" on-delete="cascade"/>

            <!-- In general think about 'all-delete-orphan'-->
            <property name="abstract"/>
            <property name="address"/>
            <property name="annotation"/>
            <property name="author"/>
            <property
                name="bibType"
                type="org.opentox.toxotis.persistence.usertypes.BibTypeUserType">
            </property>
            <property name="bookTitle"/>
            <property name="chapter"/>
            <property name="copyright"/>
            <!-- READ http://docs.jboss.org/tools/2.1.0.Beta1/hibernatetools/html_single/#d0e4159
                 for further information about the tag <meta>.
                 -->
            <property name="crossref">
                <meta  attribute="field-description">
                    Reference to some other BibTeX entry possible providing its URI of other (global) identifier.
                </meta>
            </property>
            <property name="edition"/>
            <property name="editor"/>
            <property name="isbn" length="20"/>
            <property name="issn" length="20"/>
            <property name="journal"/>
            <property column="bibkey" name="key"/>
            <property name="keywords"/>
            <property name="number" length="20"/>
            <property name="pages" length="20"/>
            <property name="series"/>
            <property name="title"/>
            <property name="url"/>
            <property name="volume"/>
            <property name="year"/>
        </joined-subclass>

        <!--
            ErrorReport extends Component
        -->
        <joined-subclass
            name="org.opentox.toxotis.core.component.ErrorReport">
            <key column="uri" on-delete="cascade"/>
            <property name="httpStatus" type="int" length="3"/>
            <property name="actor"/>
            <property name="message"/>
            <property name="details" type="string" length="8000"/>
            <property name="errorCode" />
            <many-to-one name="errorCause" cascade="all" class="org.opentox.toxotis.core.component.ErrorReport"/>
        </joined-subclass>

        <!--
            Feature extends OTComponent
        -->
        <joined-subclass
            name="org.opentox.toxotis.core.component.Feature"
            table="Feature">
            <key
                column="uri"
                on-delete="cascade"
                foreign-key="uri_in_feature"/>
            <property name="units" type="string" length="50"/>
            <set name="ontologies" table="FeatOntol" cascade="all-delete-orphan"><!-- Every feature is endowed with a set of ont. classes-->
                <key column="featureUri"/>
                <many-to-many class="org.opentox.toxotis.ontology.OntologicalClass" foreign-key="featureOntology">
                    <column name="DATATYPE_NS"/>
                    <column name="DATATYPE_Name" length="50"/>
                </many-to-many>
            </set>
            <set name="admissibleValues" table="FeatAdmVal">
                <key column="featureUri"/>
                <many-to-many class="org.opentox.toxotis.ontology.LiteralValue"/>
            </set>
        </joined-subclass>

        <joined-subclass
            name="org.opentox.toxotis.core.component.FeatureValue"
            table="FeatureValue">
            <key column="uri" on-delete="cascade"/>
            <many-to-one
                name="feature"
                class="org.opentox.toxotis.core.component.Feature"
                cascade="all"
                foreign-key="feature_in_featureValue"/>
            <many-to-one
                name="value"
                class="org.opentox.toxotis.ontology.LiteralValue"
                cascade="all"
                foreign-key="literal_in_featureValue"/>
        </joined-subclass>


        <!--
            Parameter extends OTComponent
        -->
        <joined-subclass
            name="org.opentox.toxotis.core.component.Parameter"
            table="Parameter">
            <key
                column="uri"
                on-delete="cascade"
                foreign-key="parameterUri_references_OTComponent"/>
            <property name="scope" type="org.opentox.toxotis.persistence.usertypes.ParamScopeUserType"/>
            <many-to-one
                name="typedValue"
                class="org.opentox.toxotis.ontology.LiteralValue"
                cascade="all"
                foreign-key="typedValueInParameter_references_Literal"/>
        </joined-subclass>


        <!--
            Task extends OTComponent
        -->
        <joined-subclass
            name="org.opentox.toxotis.core.component.Task"
            table="Task">
            <key
                column="uri"
                on-delete="cascade"
                foreign-key="uri_in_task_references_OTComponent"/>
            <property name="resultUri" type="org.opentox.toxotis.persistence.usertypes.VRIUserType"/>
            <property name="httpStatus" type="float" precision="1"/>
            <property name="percentageCompleted" type="float" precision="2"/>
            <property name="status" type="org.opentox.toxotis.persistence.usertypes.TaskStatusUserType"/>
            <many-to-one
                name="errorReport"
                class="org.opentox.toxotis.core.component.ErrorReport"
                cascade="all"
                foreign-key="errReport_in_task"/>
        </joined-subclass>

        <!--
            Algorithm extends OTComponent
        -->
        <joined-subclass
            name="org.opentox.toxotis.core.component.Algorithm"
            table="Algorithm">
            <key
                column="uri"
                on-delete="cascade"
                foreign-key="uri_in_algorithm_references_OTComponent"/>
            <set name="parameters" cascade="all" table="AlgorithmParams">
                <key
                    column="algorithmUri"
                    foreign-key="algorithmUri_ref_for_Parameters"/>
                <many-to-many
                    class="org.opentox.toxotis.core.component.Parameter"
                    column="parameterUri"
                    foreign-key="parameterUri_ref_for_ontologies"/>
            </set>
            <set
                name="ontologies"
                table="AlgorithmOntol"
                cascade="all-delete-orphan">
                <key
                    column="algorithmUri"
                    foreign-key="algorithmUri_ref_for_ontologies"/>
                <many-to-many class="org.opentox.toxotis.ontology.OntologicalClass" foreign-key="algorithmOntology">
                    <column name="DATATYPE_NS"/>
                    <column name="DATATYPE_Name" length="50"/>
                </many-to-many>
            </set>
        </joined-subclass>


    </class>
</hibernate-mapping>
